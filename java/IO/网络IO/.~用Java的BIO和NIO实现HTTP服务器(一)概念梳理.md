# 用Java的BIO和NIO实现HTTP服务器(一)  概念梳理



## 前言

关于网络相关的文章已经写过很多了:

[1]《计算机网络引论》

[2]《计算机网络安全引论》

[3]《NIO 学习笔记(一)初遇》

[4]《Socket简介和I/O多路复用》

[5]《NIO 学习笔记(二)相识篇》

[6]《NIO学习笔记(三) 甚欢篇》

[7]《Netty学习笔记(一)初遇篇》

[8]《HTTP/2.0的二进制是什么?》

[9] 《我们来聊聊HTTPS吧》

[10] TCP 学习笔记(三) 可靠传输

[11] HTTP学习笔记(三) HTTP/2

[12] TCP学习笔记(二) 相识篇

[13] HTTP协议学习笔记(一) 初遇篇

[14]  TCP学习笔记(一) 初遇篇

本系列打算糅合这些文章，使用Java写一个简单的HTTP/HTTPS服务器，我的预设是希望读者诸君已经看过上面的文章了，但是数了数上面大致有十四篇了，希望 读者诸君已阅上面的文章，想来有些奢望。那这里大致的理理这些文章的结构，并给出一个阅读本篇的最小知识点。让我们从网络通信开始说起，如果通信的双方不是面对面，那么交流就要借助于载体，我想起小时候经常看的武侠电影，卧底将情报绑在信鸽的腿上，但是这样传递情报的方式，情报就有被篡改、丢失、截获的风险。篡改、丢失、截获，这也是通信要面临的三个问题。随着时代的发展，越来越快的交互信息变得越来越迫切，计算机帮助我们完成任务之后，我们希望也在计算机上完成信息的交换，那么要完成信息的交换，两台计算机势必要有信道，信道是传输信息的通道，但是有了通道还不够，通信的双方还需要彼此知道地址，有了地址还不够，我们还要避免信息的截获、丢失、篡改。

在通信的时候，通信的双方是明确的，也就是说我知道我要和谁通信，以上就概括了两台计算机通信要面临的问题，面对这么多问题，计算机互联网的先驱们，选择了分层来解决问题，两台计算机之间的信道被划到物理层，信息最终要转变为信号，而物理层就负责传输信号。单纯的0和1没有任何意义，必须规定解读方式，多少个电信号算一组？ 每个信号位有何意义？ 如果我们只有两台计算机，信号送给是明确的，最早的网络是猫+电话线，连一条电话线。理论上双方只要完成拨号，双方就能进行通信。这个过程跟两个人打电话没什么区别。如下图所示, 图片来自https://labpub.com/learn/silver/wi7/modems.html

![img](https://labpub.com/learn/silver/wi7/modem_2.gif)

这种链路我们称之为点对点链路。点对点链路的有点是简单，缺点是每加入一台计算机，就要给电脑新配置一个猫，如果我有多台电脑，这些电脑需要互相连接，就需要每个电脑的猫连接到一起，这带来的成本很高，管理成本也非常重，这种连接方式被称为全网状拓扑(Full Mesh)网络。这种连接方式也不是一无是处，优点是可靠性高，网络中部分链接出现故障不会影响到整个网络。但成本高，维护困难是真的承受不住。

![img](https://pic1.zhimg.com/v2-093d6a428365f6d0df17c4a6df0d9054_r.jpg?source=1940ef5c)

为了降低成本，人们想到了另外一种连接方式，也就是所有的电脑只需要连接一个猫，然后所有猫连接到同一条网线上(叫总线)。我们称这种连接方式为总线网络。这种方式的确降低了组网的成本，但是使用成本却上升了。如果上图中的A想给B发送数据，可以启动自己的猫发送，那么如果此时C和D发数据，那么就会形成干扰，最终谁的数据也发不出来。为了解决这个问题，人们规定，如果想发数据，必须先试用自己的猫听一下网线上有没有其他电脑正在通信。如果有，就自觉等待一段时间，然后再检查。这套机制后来演化了成载波侦听多路访问/碰撞检测(CSMA/CD)机制。教科书上都会将这个CSMA/CD(我已经给忘记了)。

解决了冲突问题，总线网络就能工作吗？当然是不能的! 我们在签名讲的点对点两边各有一台电脑，收房双方非常明确，不需要额外信息。那么在总线网络中，所有电脑共享一条电缆，可以同时接收网络上的全部信号。那大家如何确定数据是如何发给自己的呢？为了解决这个问题，人们发明了数据帧这个概念。帧是发送数据的最小单位，当时有很多链路层协议，以太网只是后面涉及的一种。但是不同的帧结构都是大同小异，核心都包含目标地址、源地址和数据三部分，这也是和寄信一样，信封是携带了发送人的地址、收信人的地址、信内容。

![img](https://picx.zhimg.com/80/v2-c88cbfed6264fc4f871346592e192468_720w.webp?source=1940ef5c)

这里首次出现了地址这个概念。正是因为总线网线中所有设备共享总线，所以需要通过引入地址的概念来区分不同的设备。对于以太网，这个地址就是我们常说的MAC地址。这个时候猫已经变成了我们现在常说的网卡了。以太网规定MAC地址占6个字节，也就是前面说的48位。

所有发出的包都带着目标电脑的MAC地址。网络中所有设备收到数据后悔自觉比较目标地址是不是自己，如果不是就丢弃，是的，你没有听错，全凭大家自觉。这样就解决了上面我们提出的问题。

引入地址的概念，也就产生了新的问题-如何给计算机设置MAC地址呢？ 不同的网络有不同的处理方式。

曾经有一种叫ARCNET的网络协议，它的MAC地址只有1个字节(8位)，需要网络管理员通过网卡上的拨动开关手工设置开关设置。好在当年能连网的设备很少，8位地址可以支持最多256台设备连网，也够用了。

![img](https://picx.zhimg.com/80/v2-7ab58e16a320d5bc04e7842db790cbbc_720w.webp?source=1940ef5c)

以太网规定在网卡出厂的时候就得分配48位MAC地址，全球唯一。

随着总线网络的普及，越来越多的大公司或者是大学开始使用网络连接它们的设备。为了方便传输数据，人们还发明了网桥，我们可以将网桥想象成装有多个网卡的设备，每个网卡连接一个总线网络。网桥唯一的作用就是把一个网卡收到的内容原样转发到另一张网卡所在的网络。

![img](https://picx.zhimg.com/80/v2-ccdeabbffbfbd33f42979d610f2df7cb_720w.webp?source=1940ef5c)







很多设计都要从历史上得到的答案。

## 基本API介绍







## 大致结构







## BIO模式





## 参考资料

- 有了 IP 地址，为什么还要用 MAC 地址？ https://www.zhihu.com/question/21546408
