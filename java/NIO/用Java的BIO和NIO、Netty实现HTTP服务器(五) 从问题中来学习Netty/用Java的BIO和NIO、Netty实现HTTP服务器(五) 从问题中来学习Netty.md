# 用Java的BIO和NIO、Netty实现HTTP服务器(五) 从问题中来学习Netty

[TOC]

## 前言

原本这一篇是打算放到《用Java的BIO和NIO、Netty实现HTTP服务器(四) 从问题中来学习Netty》里面的，但是想来放在一起跟四里面的内容整体连贯性不太强，索性就将这部分内容单独放出来一篇，本篇我们主要从《jdk17下netty导致堆内存疯涨原因排查 | 京东云技术团队》这篇文章的问题入手来学习Netty，首先对方给了一张图:

![](https://a.a2k6.com/gerald/i/2024/03/02/v5jy.jpg)

文章中对这个系统的描述是: “客户端和服务端底层通过netty直接进行tcp通信，且服务端也是基于netty将数据备份到对应的slave集群”。然后说要升级到JDK 17，然后用ZGC延迟相对低一点。会想一下我们在用《Java的BIO和NIO、Netty实现HTTP服务器(四)》里面讲的背压，



这篇文章接着说: 采用jdk17+zgc经过相关的压测后，一切都在向着好的方向发展，但是在一种特殊场景压测，需要将数据从北京数据中心同步给宿迁数据中心的时候，发现了一些诡异的事情

1. 服务端容器的内存疯涨，并且停止压测后，内存只是非常缓慢的减少。

2. 相关机器cpu一直保存在20%（已经无流量请求）

3. 一直在次数不多的gc。大概每10s一次

## 1. 为什么内存非常缓慢的减少?







## 2. 相关CPU问题



##  3.ZGC的触发机制





## 然后我觉得京东云这个结论是有问题的

流水线机制的引入



## 那应该怎么做呢

